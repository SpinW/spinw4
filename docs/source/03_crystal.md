---
title: Crystal structure
keywords: docs
sidebar: sw_sidebar
permalink: crystal.html
summary: Everything about defining crystal structure
folder: documentation
mathjax: 'true'
---

This section introduces how to define a crystal structure.

## Definition of the lattice

For defining a spin Hamiltonian, first we need a magnetic lattice. SpinW builds magnetic lattices on top of crystal structures, so first we need to define a crystal structure. For simple magnetic lattices this seems to be an unnecessary extra step, however to model real systems with space group symmetry, defining a magnetic lattice on top of a crystal structure make things easier.

Before we define a new crystal structure, we initialize an empty SpinW object:
```
>>model = spinw
>>model.lattice>>
```
The [spinw.lattice] property will store all the information that defines the lattice (without the atoms). The default values give a cubic lattice (angles are stored in radian) with a lattice parameter of 3 \\ang and no symmetry (`spinw.lattice.sym` field is empty).

The [spinw.genlattice] function can be used to modify the lattice:
```
>>>model = spinw
>>model.genlattice('lat_const',[2.71 2.71 13],'angled',[90 90 120],'spgr','R -3 m')
>>model.lattice>>
```
Here we modified the lattice parameters and angles (the `angled` parameter takes angles in units of degree) and defined a space group. Space groups with standard settings can be added simply by using their name, e.g. `'R -3 m'` which corresponds to the labels stored in the `symmetry.dat` file (to see the content of this file type `edit symmetry.dat` into the Matlab Command Window). The `spgr` parameter also accepts directly space group operators, for details see section [section.symmetry].

## Generation of crytal structure

To add atoms to the lattice we use the [spinw.addatom] command with at least the position must be given using the `r` parameter. The position is given in a vector of 3 numbers and in lattice units. This will define a non-magnetic atom. Also a string label can be assigned to each atom using the `label` parameter:

```
>>>model = spinw
>>>model.genlattice('lat_const',[2.71 2.71 13],'angled',[90 90 120],'spgr','R -3 m')
>>model.addatom('r',[0 0   0],'label','MCu2')
>>model.addatom('r',[0 0 1/2],'label','O')
>>model.unit_cell>>
```
After running the above example, the added atoms are stored in the [spinw.unit_cell] property. This property stores only the symmetry inequivalent atoms and their properties (no symmetry operators are applied at this point). The most important property beside the atomic position is the spin quantum number of the atoms, stored in `spinw.unit_cell.S`. In the above example we did not give the spin quantum number directly, thus it is from the given `label` parameter of [spinw.addatom]. Each label is searched in the `magion.dat` file and if a match is found the spin value is imported. If no match is found the default spin quantum number of 0 is saved in [spinw.unit_cell] making the atom non-magnetic, as it happened for oxygen in the above example. The spin quantum number can be also directly given using the `S` parameter of [spinw.addatom].

SpinW does not store the symmetry equivalent atomic positions, but it generates dynamically from [spinw.unit_cell] using the [spinw.atom] method. The method returns a structure that contains all atomic positions generated by the space group:
```
>>>model = spinw
>>>model.genlattice('lat_const',[2.71 2.71 13],'angled',[90 90 120],'spgr','R -3 m')
>>>model.addatom('r',[0 0   0],'label','MCu2')
>>>model.addatom('r',[0 0 1/2],'label','O')
>>model.atom>>
```
The Matlab [matlab.struct] type output (we will call it structure afterwards) contains all the atomic positions in a matrix with dimensions of $[3\times n_{atom}]$ (if you ask why is this dimension, check section [section.introduction#matrix-dimensions]), in our case 6 atoms. The output structure has another field, `idx` which identifies each generated atom via the index of the symmetry inequivalent parent atom in [spinw.unit_cell]. The third field `mag` tells if a generated atom magnetic ($S>0$) or not.

To generate only the magnetic atoms, use the [spinw.matom] method. This function also returns the spin value for each magnetic atom:
```
>>>model = spinw
>>>model.genlattice('lat_const',[2.71 2.71 13],'angled',[90 90 120],'spgr','R -3 m')
>>>model.addatom('r',[0 0   0],'label','MCu2')
>>>model.addatom('r',[0 0 1/2],'label','O')
>>model.matom>>
```

Since this is one of the functions that is most often called internally, it caches the results. This means that after the first call, the result is stored in [spinw.cache] and in consecutive calls it simply returns the cached values. There is also a mechanism (see [Create Property Listeners](https://www.mathworks.com/help/matlab/matlab_oop/listening-for-changes-to-property-values.html#brkimdj-1) in the Matlab documentation). 




## Coordinate systems
## Lattice transformations
## Atomic properties
